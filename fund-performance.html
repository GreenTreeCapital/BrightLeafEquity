<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fund Performance | Green Tree Capital</title>

  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f3f3e9; color: #1e3a2d; }
    a { color: #1e3a2d; }

    header { background-color: #e8e5d8; padding: 16px 40px; border-bottom: 2px solid #1e3a2d; }
    .header-inner {
      max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;
    }
    .logo { display: flex; align-items: center; gap: 16px; }
    .logo img { height: 90px; }
    .logo-text { text-transform: uppercase; letter-spacing: 0.08em; font-size: 1.05rem; font-weight: bold; margin-top: 4px; }

    nav { display: flex; gap: 42px; }
    nav a {
      text-decoration: none; font-weight: bold; color: #1e3a2d; font-size: 1rem;
      border-bottom: 2px solid transparent; padding-bottom: 5px;
    }
    nav a:hover { border-bottom: 2px solid #2f5745; }
    nav a.active { border-bottom: 2px solid #1e3a2d; }

    .container { max-width: 1000px; margin: 40px auto 50px; padding: 0 20px; }
    h1 { font-size: 2.1rem; margin-bottom: 10px; }
    h2 { margin-top: 0; }
    p { line-height: 1.6; font-size: 0.98rem; }

    .chart-wrapper {
      background: #f7f6ec; border: 1px solid #d3d0c0; border-radius: 6px;
      padding: 16px 18px; margin-top: 25px;
    }
    canvas { width: 100%; max-height: 360px; }
    .pie-wrap canvas { max-height: 320px; }

    table { width: 100%; border-collapse: collapse; margin-top: 25px; font-size: 0.95rem; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #d3d0c0; text-align: left; }
    th { background: #e8e5d8; }

    .muted { font-size: 0.9rem; color: #44594c; margin-top: 10px; }
    .pill {
      display: inline-block; padding: 4px 10px; border-radius: 999px; font-size: 0.85rem;
      border: 1px solid #1e3a2d; background: #eceadd; margin-left: 8px;
    }

    .disclaimer-box {
      font-size: 0.85rem; line-height: 1.5; padding: 14px 18px;
      border: 1px solid #1e3a2d; background: #eceadd; margin-top: 30px;
    }

    footer { text-align: center; padding: 14px 20px; border-top: 2px solid #1e3a2d; font-size: 0.85rem; background: #e8e5d8; }
    footer a { text-decoration: none; margin-left: 8px; }
    footer a:hover { text-decoration: underline; }

    @media (max-width: 720px) {
      nav { flex-wrap: wrap; gap: 18px; }
      .logo img { height: 75px; }
    }
  </style>
</head>

<body>
<header>
  <div class="header-inner">
    <div class="logo">
      <img src="logo.png" alt="Green Tree Capital Logo">
      <div class="logo-text">Green Bull Capital</div>
    </div>

    <nav>
      <a href="index.html" class="nav-home">Home</a>
      <a href="about.html" class="nav-about">About</a>
      <a href="market-news.html" class="nav-news">Market News</a>
      <a href="fund-performance.html" class="nav-fund active">Fund Performance</a>
      <a href="pricing.html" class="nav-pricing">Pricing</a>
      <a href="join-discord.html" class="nav-discord">Join the Discord</a>
    </nav>
  </div>
</header>

<main>
  <div class="container">

    <h1>
      Fund Performance Overview
      <span class="pill">12 Month Track Record</span>
    </h1>

    <p class="muted">
      Data is pulled from <code>data/performance.json</code> (updated weekly by GitHub Actions).
    </p>

    <!-- ONE chart only: last 52 weeks -->
    <div class="chart-wrapper">
      <h2>Long-Term Fund (Past 12 Months — Weekly)</h2>
      <canvas id="longTermChart"></canvas>
      <p class="muted" id="ltStatus">Loading…</p>
    </div>

    <!-- PIE chart -->
    <div class="chart-wrapper pie-wrap">
      <h2>Long-Term Fund Allocation (Holdings by Weight)</h2>
      <canvas id="holdingsPie"></canvas>
      <p class="muted" id="pieStatus">Loading allocation…</p>
    </div>

    <!-- Summary -->
    <table>
      <thead>
        <tr>
          <th>Strategy</th>
          <th>Latest Value (Index = 100)</th>
          <th>Change Since Inception</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Long-Term Fund</td>
          <td id="ltLatest">—</td>
          <td id="ltChange">—</td>
          <td>Auto-updated weekly from <code>data/performance.json</code>.</td>
        </tr>
      </tbody>
    </table>

    <!-- Holdings -->
    <h2 style="margin-top:28px;">Full Portfolio Holdings</h2>
    <p class="muted" style="margin-top:6px;">
      Auto-populated from <code>data/performance.json</code>.
    </p>

    <table>
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Name</th>
          <th>Weight</th>
          <th>Latest Price</th>
        </tr>
      </thead>
      <tbody id="holdingsBody">
        <tr><td colspan="4" class="muted">Loading holdings…</td></tr>
      </tbody>
    </table>

    <div class="disclaimer-box">
      <strong>Disclosure:</strong> Performance figures and charts on this page are for
      educational/entertainment purposes only. They do not reflect audited results, or any client performance.
      Nothing here is investment advice.
    </div>

  </div>
</main>

<footer>
  © 2025 Green Tree Capital — Educational Only
  <a href="disclaimer.html">Disclaimer</a>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let longTermChartInstance = null;
  let holdingsPieInstance = null;

  function lastN(arr, n) { return arr.slice(Math.max(arr.length - n, 0)); }
  function fmt(n) { return Number(n).toFixed(1); }
  function fmtPct(p) { return (p >= 0 ? "+" : "") + Number(p).toFixed(1) + "%"; }

  async function loadFromJSON() {
    const ltStatus = document.getElementById("ltStatus");
    const pieStatus = document.getElementById("pieStatus");

    try {
      const res = await fetch("data/performance.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Could not load data/performance.json");
      const perf = await res.json();

      const labelsAll = Array.isArray(perf.labels) ? perf.labels : [];
      const seriesAll = Array.isArray(perf.longTermIndex) ? perf.longTermIndex : [];

      if (!labelsAll.length || !seriesAll.length) {
        ltStatus.textContent = "No data yet. Run the workflow once.";
        return;
      }

      // Only show last 52 weekly points
      const labels = lastN(labelsAll, 52);
      const series = lastN(seriesAll, 52);

      ltStatus.textContent = `Showing last ${labels.length} weekly points (~12 months).`;

      const ctx = document.getElementById("longTermChart").getContext("2d");
      if (longTermChartInstance) longTermChartInstance.destroy();
      longTermChartInstance = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Long-Term Fund (Index)",
            data: series,
            borderWidth: 2,
            tension: 0.25,
            pointRadius: 2
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
          scales: { y: { beginAtZero: false } }
        }
      });

      // Summary (use perf.latest if present, else last series)
      const latest = perf.latest?.index ?? seriesAll[seriesAll.length - 1];
      const first = seriesAll[0] ?? 100;
      const change = ((latest / first) - 1) * 100;

      document.getElementById("ltLatest").textContent = fmt(latest);
      document.getElementById("ltChange").textContent = fmtPct(change);

      // Holdings table
      const holdings = Array.isArray(perf.holdings) ? perf.holdings : [];
      const tbody = document.getElementById("holdingsBody");

      if (holdings.length > 0) {
        tbody.innerHTML = holdings.map(h => `
          <tr>
            <td>${h.ticker ?? "—"}</td>
            <td>${h.name ?? "—"}</td>
            <td>${((Number(h.weight) || 0) * 100).toFixed(2)}%</td>
            <td>${(h.price != null && !Number.isNaN(Number(h.price))) ? "$" + Number(h.price).toFixed(2) : "—"}</td>
          </tr>
        `).join("");
      } else {
        tbody.innerHTML = `<tr><td colspan="4" class="muted">No holdings found in data/performance.json.</td></tr>`;
      }

      // Pie chart (group tiny weights into Other)
      if (holdings.length > 0) {
        const MIN_SLICE = 0.02; // 2%
        const sorted = [...holdings].sort((a,b) => (b.weight || 0) - (a.weight || 0));

        const major = [];
        let otherWeight = 0;

        for (const h of sorted) {
          const w = Number(h.weight) || 0;
          if (w >= MIN_SLICE) major.push(h);
          else otherWeight += w;
        }

        const pieLabels = major.map(h => h.ticker || h.name || "Holding");
        const pieData = major.map(h => Number(h.weight) || 0);

        if (otherWeight > 0.00001) {
          pieLabels.push("Other");
          pieData.push(otherWeight);
        }

        pieStatus.textContent = "Weights from holdings.json (small positions grouped into Other).";

        const pieCtx = document.getElementById("holdingsPie").getContext("2d");
        if (holdingsPieInstance) holdingsPieInstance.destroy();
        holdingsPieInstance = new Chart(pieCtx, {
          type: "pie",
          data: { labels: pieLabels, datasets: [{ data: pieData }] },
          options: {
            responsive: true,
            plugins: {
              legend: { position: "bottom" },
              tooltip: {
                callbacks: {
                  label: (context) => `${context.label}: ${(Number(context.raw || 0) * 100).toFixed(2)}%`
                }
              }
            }
          }
        });
      } else {
        pieStatus.textContent = "No holdings to chart yet.";
      }

    } catch (e) {
      ltStatus.textContent = "Could not load data. Make sure data/performance.json exists and is deployed.";
      pieStatus.textContent = "Could not load allocation.";
      console.error(e);
    }
  }

  loadFromJSON();
</script>

</body>
</html>
