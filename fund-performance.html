<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fund Performance | Green Tree Capital</title>

  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f3f3e9; color: #1e3a2d; }
    a { color: #1e3a2d; }

    header { background-color: #e8e5d8; padding: 16px 40px; border-bottom: 2px solid #1e3a2d; }
    .header-inner {
      max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;
    }
    .logo { display: flex; align-items: center; gap: 16px; }
    .logo img { height: 90px; }
    .logo-text { text-transform: uppercase; letter-spacing: 0.08em; font-size: 1.05rem; font-weight: bold; margin-top: 4px; }

    nav { display: flex; gap: 42px; }
    nav a {
      text-decoration: none; font-weight: bold; color: #1e3a2d; font-size: 1rem;
      border-bottom: 2px solid transparent; padding-bottom: 5px;
    }
    nav a:hover { border-bottom: 2px solid #2f5745; }
    nav a.active { border-bottom: 2px solid #1e3a2d; }

    .container { max-width: 1000px; margin: 40px auto 50px; padding: 0 20px; }
    h1 { font-size: 2.1rem; margin-bottom: 10px; }
    h2 { margin-top: 0; }
    p { line-height: 1.6; font-size: 0.98rem; }

    .chart-wrapper {
      background: #f7f6ec; border: 1px solid #d3d0c0; border-radius: 6px;
      padding: 16px 18px; margin-top: 25px;
    }
    .chart-wrapper h2 { margin-top: 0; font-size: 1.1rem; }
    canvas { width: 100%; max-height: 360px; }
    .pie-wrap canvas { max-height: 320px; }

    table { width: 100%; border-collapse: collapse; margin-top: 25px; font-size: 0.95rem; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #d3d0c0; text-align: left; }
    th { background: #e8e5d8; }

    .muted { font-size: 0.9rem; color: #44594c; margin-top: 10px; }
    .pill {
      display: inline-block; padding: 4px 10px; border-radius: 999px; font-size: 0.85rem;
      border: 1px solid #1e3a2d; background: #eceadd; margin-left: 8px;
    }

    .disclaimer-box {
      font-size: 0.85rem; line-height: 1.5; padding: 14px 18px;
      border: 1px solid #1e3a2d; background: #eceadd; margin-top: 30px;
    }

    footer { text-align: center; padding: 14px 20px; border-top: 2px solid #1e3a2d; font-size: 0.85rem; background: #e8e5d8; }
    footer a { text-decoration: none; margin-left: 8px; }
    footer a:hover { text-decoration: underline; }

    @media (max-width: 720px) {
      nav { flex-wrap: wrap; gap: 18px; }
      .logo img { height: 75px; }
    }
  </style>
</head>

<body>
<header>
  <div class="header-inner">
    <div class="logo">
      <img src="logo.png" alt="Green Tree Capital Logo">
      <div class="logo-text">Green Tree Capital</div>
    </div>

    <nav>
      <a href="index.html" class="nav-home">Home</a>
      <a href="about.html" class="nav-about">About</a>
      <a href="market-news.html" class="nav-news">Market News</a>
      <a href="fund-performance.html" class="nav-fund active">Fund Performance</a>
      <a href="pricing.html" class="nav-pricing">Pricing</a>
      <a href="join-discord.html" class="nav-discord">Join the Discord</a>
    </nav>
  </div>
</header>

<main>
  <div class="container">

    <h1>
      Fund Performance Overview
      <span class="pill">Fictitious / Mock Track Record</span>
    </h1>

    <p>
      This page shows the performance of Green Tree Capital strategies using an index format (Inception = 100).
      The Long-Term Fund is a global ESG + value portfolio using equities, REITs, and commodities (including gold),
      with awareness of FX exposure from international holdings.
    </p>

    <p class="muted">
      Base assumption: $10,000 fully invested from inception. Values are shown as an index (start = 100).
    </p>

    <div class="chart-wrapper">
      <h2>Long-Term Fund (Full Track Record)</h2>
      <canvas id="longTermChart"></canvas>
      <p class="muted" id="ltStatus">Loading data from <code>data/performance.json</code>…</p>
    </div>

    <div class="chart-wrapper">
      <h2>Long-Term Fund (Past 12 Months — Weekly)</h2>
      <canvas id="oneYearChart"></canvas>
      <p class="muted" id="oneYearStatus">Loading 12-month view…</p>
    </div>

    <div class="chart-wrapper pie-wrap">
      <h2>Long-Term Fund Allocation (Holdings by Weight)</h2>
      <canvas id="holdingsPie"></canvas>
      <p class="muted" id="pieStatus">Loading holdings allocation…</p>
    </div>

    <div class="chart-wrapper">
      <h2>Equities vs Forex (Performance – Weekly)</h2>
      <canvas id="strategyChart"></canvas>
      <p class="muted">
        Equities target ~+5%/week on average with higher volatility. Forex targets ~+4%/week on average with lower volatility.
        A one-week “tariff regime” shock is shown as a +20% step up.
      </p>
    </div>

    <table>
      <thead>
        <tr>
          <th>Strategy</th>
          <th>Latest Value (Index = 100)</th>
          <th>Change Since Inception</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Long-Term Fund (Global ESG + Value)</td>
          <td id="ltLatest">—</td>
          <td id="ltChange">—</td>
          <td>Auto-updated from <code>data/performance.json</code> (mock).</td>
        </tr>
        <tr>
          <td>Equities Strategy</td>
          <td id="eqLatest">—</td>
          <td id="eqChange">—</td>
          <td>Higher volatility profile; “tariff regime” week includes +20% step (mock).</td>
        </tr>
        <tr>
          <td>Forex Strategy</td>
          <td id="fxLatest">—</td>
          <td id="fxChange">—</td>
          <td>Lower volatility profile; also benefits from “tariff regime” volatility expansion (mock).</td>
        </tr>
      </tbody>
    </table>

    <h2 style="margin-top:28px;">Full Portfolio Holdings (Long-Term Fund)</h2>
    <p class="muted" style="margin-top:6px;">
      Auto-populated from <code>data/performance.json</code>.
    </p>

    <table>
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Name</th>
          <th>Weight</th>
          <th>Latest Price</th>
        </tr>
      </thead>
      <tbody id="holdingsBody">
        <tr><td colspan="4" class="muted">Loading holdings…</td></tr>
      </tbody>
    </table>

    <div class="disclaimer-box">
      <strong>Disclosure:</strong> Performance figures and charts on this page are <strong>fictitious</strong> and for
      educational/entertainment purposes only. They do not reflect audited results, actual trading, or any client performance.
      Nothing here is investment advice.
    </div>

  </div>
</main>

<footer>
  © 2025 Green Tree Capital — Educational Only
  <a href="disclaimer.html">Disclaimer</a>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function fmt(n) { return Number(n).toFixed(1); }
  function fmtPct(p) { return (p >= 0 ? "+" : "") + Number(p).toFixed(1) + "%"; }
  function pctChangeFrom100(latest) { return ((latest / 100.0) - 1) * 100; }

  let longTermChartInstance = null;
  let oneYearChartInstance = null;
  let holdingsPieInstance = null;

  async function loadLongTermFromJSON() {
    const ltStatus = document.getElementById("ltStatus");
    const oneYearStatus = document.getElementById("oneYearStatus");
    const pieStatus = document.getElementById("pieStatus");

    try {
      const res = await fetch("data/performance.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Could not load data/performance.json");
      const perf = await res.json();

      const labels = Array.isArray(perf.labels) ? perf.labels : [];
      const series = Array.isArray(perf.longTermIndex) ? perf.longTermIndex : [];

      if (!labels.length || !series.length) {
        ltStatus.textContent = "No long-term fund data yet. Run the GitHub Action to populate data/performance.json.";
        oneYearStatus.textContent = "No data yet.";
        pieStatus.textContent = "No holdings data yet.";
        return;
      }

      ltStatus.textContent = "Auto-updated from data/performance.json";

      // Full track record chart
      const ctx = document.getElementById("longTermChart").getContext("2d");
      if (longTermChartInstance) longTermChartInstance.destroy();
      longTermChartInstance = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Long-Term Fund (Index)",
            data: series,
            borderWidth: 2,
            tension: 0.25,
            pointRadius: 2
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
          scales: { y: { beginAtZero: false } }
        }
      });

      // Summary row (Long-Term)
      const ltLatest = series[series.length - 1];
      document.getElementById("ltLatest").textContent = fmt(ltLatest);
      const ltChange = ((ltLatest / series[0]) - 1) * 100;
      document.getElementById("ltChange").textContent = fmtPct(ltChange);

      // Past 12 months (weekly): last 52 points
      const N = Math.min(52, series.length);
      if (N < 5) {
        oneYearStatus.textContent = "Not enough weekly points yet (need at least ~5). Keep running weekly.";
        if (oneYearChartInstance) { oneYearChartInstance.destroy(); oneYearChartInstance = null; }
      } else {
        oneYearStatus.textContent = `Showing last ${N} weekly points (~12 months).`;
        const oneLabels = labels.slice(-N);
        const oneSeries = series.slice(-N);

        const oneCtx = document.getElementById("oneYearChart").getContext("2d");
        if (oneYearChartInstance) oneYearChartInstance.destroy();
        oneYearChartInstance = new Chart(oneCtx, {
          type: "line",
          data: {
            labels: oneLabels,
            datasets: [{
              label: "Long-Term Fund (12M Weekly)",
              data: oneSeries,
              borderWidth: 2,
              tension: 0.25,
              pointRadius: 2
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { position: "bottom" } },
            scales: { y: { beginAtZero: false } }
          }
        });
      }

      // Holdings table + Pie
      const holdings = Array.isArray(perf.holdings) ? perf.holdings : [];
      const tbody = document.getElementById("holdingsBody");

      if (holdings.length > 0) {
        tbody.innerHTML = holdings.map(h => `
          <tr>
            <td>${h.ticker ?? "—"}</td>
            <td>${h.name ?? "—"}</td>
            <td>${((Number(h.weight) || 0) * 100).toFixed(2)}%</td>
            <td>${(h.price != null && !Number.isNaN(Number(h.price))) ? "$" + Number(h.price).toFixed(2) : "—"}</td>
          </tr>
        `).join("");

        // Pie chart (group small slices)
        const MIN_SLICE = 0.02; // 2%
        const sorted = [...holdings].sort((a,b) => (b.weight || 0) - (a.weight || 0));

        const major = [];
        let otherWeight = 0;
        for (const h of sorted) {
          const w = Number(h.weight) || 0;
          if (w >= MIN_SLICE) major.push(h);
          else otherWeight += w;
        }

        const pieLabels = major.map(h => h.ticker || h.name || "Holding");
        const pieData = major.map(h => Number(h.weight) || 0);
        if (otherWeight > 0.00001) { pieLabels.push("Other"); pieData.push(otherWeight); }

        pieStatus.textContent = "Weights from holdings (small positions grouped into Other).";

        const pieCtx = document.getElementById("holdingsPie").getContext("2d");
        if (holdingsPieInstance) holdingsPieInstance.destroy();
        holdingsPieInstance = new Chart(pieCtx, {
          type: "pie",
          data: { labels: pieLabels, datasets: [{ data: pieData }] },
          options: {
            responsive: true,
            plugins: {
              legend: { position: "bottom" },
              tooltip: {
                callbacks: {
                  label: (context) => `${context.label}: ${(Number(context.raw || 0) * 100).toFixed(2)}%`
                }
              }
            }
          }
        });

      } else {
        tbody.innerHTML = `<tr><td colspan="4" class="muted">No holdings found in data/performance.json yet.</td></tr>`;
        pieStatus.textContent = "No holdings to chart yet.";
        if (holdingsPieInstance) { holdingsPieInstance.destroy(); holdingsPieInstance = null; }
      }

    } catch (e) {
      ltStatus.textContent = "Could not load auto data. Make sure data/performance.json exists and is deployed on GitHub Pages.";
      oneYearStatus.textContent = "Could not load 12-month view.";
      pieStatus.textContent = "Could not load holdings allocation.";
      console.error(e);
    }
  }

  // MOCK: Equities vs Forex (weekly)
  const wLabels = [
    "W1","W2","W3","W4","W5","W6","W7","W8","W9","W10",
    "W11 (Tariffs)","W12","W13","W14","W15","W16","W17","W18","W19","W20"
  ];

  const equitiesData = [
    100.0, 106.0, 103.0, 111.0, 116.0,
    112.0, 120.0, 125.0, 121.0, 128.0,
    153.6, 160.0, 154.0, 166.0, 171.0,
    165.0, 176.0, 184.0, 179.0, 192.0
  ];

  const forexData = [
    100.0, 103.5, 104.8, 109.0, 112.2,
    114.6, 117.0, 119.9, 123.2, 126.0,
    151.2, 155.0, 157.0, 160.2, 162.5,
    165.0, 167.2, 170.0, 172.1, 175.5
  ];

  new Chart(document.getElementById("strategyChart").getContext("2d"), {
    type: "line",
    data: {
      labels: wLabels,
      datasets: [
        { label: "Equities (Index)", data: equitiesData, borderWidth: 2, tension: 0.35, pointRadius: 2 },
        { label: "Forex (Index)", data: forexData, borderWidth: 2, tension: 0.2,  pointRadius: 2 }
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: "bottom" } },
      scales: { y: { beginAtZero: false } }
    }
  });

  // Summary rows (Equities + Forex)
  const eqLatest = equitiesData[equitiesData.length - 1];
  const fxLatest = forexData[forexData.length - 1];

  document.getElementById("eqLatest").textContent = fmt(eqLatest);
  document.getElementById("eqChange").textContent = fmtPct(pctChangeFrom100(eqLatest));

  document.getElementById("fxLatest").textContent = fmt(fxLatest);
  document.getElementById("fxChange").textContent = fmtPct(pctChangeFrom100(fxLatest));

  // Load Long-Term Fund from JSON (Step 4 output)
  loadLongTermFromJSON();
</script>

</body>
</html>
